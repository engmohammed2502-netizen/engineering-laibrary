
pm2 stop engineering-library-api


cd /var/www/engineering-library/server

# حذف المكاتب القديمة لضمان نظافة التثبيت (مثلما فعلنا في الرياكت)
rm -rf node_modules package-lock.json

# تثبيت المكاتب من جديد
npm install


npm list morgan



pm2 restart engineering-library-api
pm2 logs engineering-library-api --lines 50




const auth = require('./auth');
const permissions = require('./permissions');
const security = require('./security');
const upload = require('./upload');

module.exports = {
  auth,
  permissions,
  security,
  upload
};















# أولاً: أوقف MongoDB إذا كان يعمل
sudo systemctl stop mongod 2>/dev/null || true
sudo pkill -f mongod 2>/dev/null || true

# ثانياً: إنشاء مجلد للبيانات
sudo mkdir -p /data/db
sudo chmod 777 /data/db

# أو استخدم مسار في home
mkdir -p ~/mongodb-data
sudo chmod 777 ~/mongodb-data

# ثالثاً: تشغيل mongod
sudo mongod --dbpath /data/db --fork --logpath /var/log/mongodb.log --bind_ip 0.0.0.0

# أو بدون sudo
mongod --dbpath ~/mongodb-data --fork --logpath ~/mongodb.log --bind_ip 0.0.0.0







# تشغيل الخدمة
sudo systemctl start mongod

# تمكين التشغيل التلقائي عند الإقلاع
sudo systemctl enable mongod

# التحقق من حالة الخدمة
sudo systemctl status mongod








sudo npm install -g pm2 --registry=https://registry.npmmirror.com





#خطوات تريبل شوت


# 1. تحقق من تشغيل الخدمات
sudo systemctl status mongodb
pm2 status

# 2. تحقق من المنافذ
sudo netstat -tulpn | grep :9000

# 3. شاهد السجلات
pm2 logs engineering-library-api
tail -f /var/log/mongodb/mongod.log

# 4. اختبار الاتصال
curl -v http://localhost:9000/api/health

# 5. إعادة التشغيل
pm2 restart engineering-library-api






# انتقل للمجلد الرئيسي
cd /var/www/engineering-library

# أنشئ قاعدة البيانات
mongosh --eval "
use engineering_library
db.createCollection('users')
db.users.insertOne({
  universityId: 'zero',
  name: 'System Root',
  password: '\$2a\$12\$6VX8Q7bY5Z9Q9Q9Q9Q9Q9Q.9Q9Q9Q9Q9Q9Q9Q9Q9Q9Q9Q9Q9Q9Q9Q', // 975312468qq مشفرة
  role: 'root',
  isActive: true,
  createdAt: new Date()
})
print('✅ قاعدة البيانات وحساب الروت جاهزان')
"
